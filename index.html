<!DOCTYPE html>
<html lang=id>
	<head>
		<title>Unicode cipher</title>
		<meta http-equiv=Content-Type content="text/html; charset=utf-8">
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	</head>
	<body>
		<div style="background-color: lightgreen;">
			<p>Original Text:</p>
			<textarea id="teksAsal" rows="30" cols="100" spellcheck="false" autocapitalize="off"></textarea><br>
			<input onchange="loadText(this)" id="loadText" type="file">
				<label for="loadText"> File to Base64</label><br>
			<input onchange="loadTextCode(this)" id="loadTextCode" type="file" accept=".ciphereki">
				<label for="loadTextCode"> Ciphereki to String</label>
		</div>
		<div style="background-color: lightblue;">
			<p>Caesar Key:</p>
			<input oninput="return $(this).val(this.value.replace(/[^0-9]/g, ''))" type="text" id="caesarKeyInput" size="98"><br>
			<input onclick="plusMinusCaesarFunction()" type="button" value="+" id="plusMinusCaesar"/>
			<p id="caesarKeyDebug">Caesar key = </p>
		</div>
		<div style="background-color: lightpink;">
			<p>Vigenere Key:</p>
			<textarea id="vigenereKeyInput" rows="10" cols="100"></textarea><br>
			<input onclick="plusMinusVigenereFunction()" type="button" value="+" id="plusMinusVigenere"/>
			<p id="vigenereKeyDebug">Vigenere key = </p>
		</div>
		<div style="background-color: mediumpurple;">
			<input onclick="cipherText()" type="button" value="Ubah" id="cipherText"/>
			<p>Cipher Text:</p>
			<textarea id="teksHasil" rows="30" cols="100" spellcheck="false" autocapitalize="off" readonly></textarea>
			<input onclick="$('#teksAsal').val(''); $('#teksAsal').val($('#teksHasil').val())" type="button" value="â†‘" id="moveUp"/><br>
			<input type="text" id="saveTextFileName"><input onclick="saveText()" type="button" value="Save File" id="saveText"/>
				<label for="saveText"> Base64 to File</label><br>
			<input type="text" id="saveTextFileCodeName"><input onclick="saveTextCode()" type="button" value="Save File" id="saveTextCode"/>
				<label for="saveTextFileCodeName"> String to Ciphereki</label>
		</div><br>
		<p id="proses"></p>
		<script>
			"use strict";
			let caesarKey = 0;
			let vigenereKey = [0];
			let plusMinusCaesar = 1; //Buat variabel penentu apakah caesar cipher digeser ke depan atau belakang (Kalau 1 geser ke depan, kalau -1 geser ke belakang)
			let plusMinusVigenere = 1; //Buat variabel penentu apakah vigenere cipher digeser ke depan atau belakang
			function loadText(input) { //Buka file dan ubah menjadi format Base64
				const reader = new FileReader();
				reader.readAsDataURL(input.files[0]); //Base64
				reader.onload = function (event) {
					$("#teksAsal").val(event.target.result);
					$("#loadText").val("");
				};
			}
			function loadTextCode(input) { //Buka file dengan format .ciphereki
				const reader = new FileReader();
				reader.readAsText(input.files[0]);
				reader.onload = function(event) {
					const text = event.target.result;
					const encode = text.split("u");
					encode.shift();
					let encodeText = [];
					for (let i = 0; i < encode.length; i++) {
						encode[i] = "0x" + encode[i];
						encodeText[i] = String.fromCodePoint(parseInt(encode[i], 16));
					}
					$("#teksAsal").val(encodeText.join(""));
					$("#loadTextCode").val("");
				};
			}
			function getCaesarKey() {
				let angka = $("#caesarKeyInput").val(); //Ambil kunci caesar
				if (angka.length !== 0) { //Jika kunci caesar tidak kosong, jalankan if
					angka = parseInt(angka) * plusMinusCaesar; //Menentukan apakah caesar cipher digeser ke depan atau belakang
					return angka;
				}
				else {
					return [0];
				}
			}
			function setCaesarKeyDebug() { //Menunjukkan kunci cipher yang digunakan
				$("#caesarKeyDebug").html("Caesar key = " + caesarKey);
			}
			function plusMinusCaesarFunction() { //Fungsi untuk menentukan apakah caesar cipher digeser ke depan atau belakang
				const elem = $("#plusMinusCaesar");
				if (elem.val() === "+") {
					elem.val("-");
				}
				else {
					elem.val("+");
				}
				plusMinusCaesar *= -1;
				caesarKey = getCaesarKey();
				setCaesarKeyDebug();
			}
			function getVigenereKey() {
				const huruf = $("#vigenereKeyInput").val(); //Ambil kunci vigenere
				if (huruf.length !== 0) { //Jika kunci vigenere tidak kosong, jalankan if
					const arrayKunci = [...huruf]; //Ubah kunci vigenere ke bentuk array berisi huruf
					const codepointsVigenere = [...huruf]; //Buat array berisi kode poin sejumlah huruf
					for (let i = 0; i < arrayKunci.length; i++) { //Jalankan sebanyak jumlah huruf pada arrayKunci
						codepointsVigenere[i] = parseInt(arrayKunci[i].codePointAt(0)) * plusMinusVigenere; //Ubah isi codepointsVigenere dari huruf ke kode poin tiap-tiap huruf sekaligus menentukan apakah vigenere cipher digeser ke depan atau belakang
					}
					return codepointsVigenere;
				}
				else { //Jika kunci vigenere kosong, maka kunci vigenere adalah 0
					return [0];
				}
			}
			function setVigenereKeyDebug() { //Menunjukkan semua kunci vigenere yang digunakan
				$("#vigenereKeyDebug").html("Vigenere key = " + vigenereKey);
			}
			function plusMinusVigenereFunction() { //Fungsi untuk mengubah apakah vigenere cipher digeser ke depan atau belakang
				const elem = $("#plusMinusVigenere");
				if (elem.val() === "+") {
					elem.val("-");
				}
				else {
					elem.val("+");
				}
				plusMinusVigenere *= -1;
				vigenereKey = getVigenereKey();
				setVigenereKeyDebug();
			}
			function cipherText() {
				if ($("#teksAsal").val().length > 0) { //Jika teks asal tidak kosong, jalankan fungsi:
					$("#teksHasil").val(""); //Kosongkan textarea hasil cipher
					const teksAsal = $("#teksAsal").val(); //Ambil textarea asal
					caesarKey = getCaesarKey(); //Ambil kunci caesar
					vigenereKey = getVigenereKey(); //Ambil kunci vigenere
					let vigenereIndex = 0; //Buat variabel untuk menentukan posisi kunci vigenere yang akan digunakan
					const arrayCipher = []; //Buat array kosong yang nanti akan diisi teks hasil cipher
					const arrayKarakter = [...teksAsal]; //Ubah teks ke array berisi tiap-tiap huruf
					const decrypting = Boolean(parseInt(arrayKarakter[1].codePointAt(0)) === 0); //Memeriksa apakah karakter kedua adalah karakter dengan kode poin 0, jika iya maka teks akan didekripsi
					const codepoints = []; //Buat array kosong yang nanti akan diisi kode poin
					//const proses = []; //Buat variabel untuk menunjukkan step-step penjumlahan cipher yang dilakukan
					for (let i = 0; i < arrayKarakter.length; i++) { //Jalankan sebanyak jumlah huruf pada arrayKarakter
						if (decrypting === true && parseInt(arrayKarakter[i].codePointAt(0)) === 0) { //Jika teks didekripsi, maka karakter dengan kode poin 0 akan dihapuskan
							arrayCipher[i] = "";
						}
						else {
							if (parseInt(arrayKarakter[i].codePointAt(0)) === 1) { //Jika karakter memiliki kode poin 1
								codepoints[i] = 13 + parseInt(caesarKey) + parseInt(vigenereKey[vigenereIndex]); //Ubah kode poin 1 menjadi 13, lalu jumlahkan dengan kunci caesar dan kunci vigenere
								//proses[i] = "13" + " + " + String(caesarKey) + " + " + String(vigenereKey[vigenereIndex]); //Menunjukkan step-step penjumlahan cipher yang dilakukan
							}
							else {
								codepoints[i] = parseInt(arrayKarakter[i].codePointAt(0)) + parseInt(caesarKey) + parseInt(vigenereKey[vigenereIndex]); //Jumlahkan kode poin per huruf dengan kunci caesar dan kunci vigenere
								//proses[i] = arrayKarakter[i].codePointAt(0) + " + " + String(caesarKey) + " + " + String(vigenereKey[vigenereIndex]); //Menunjukkan step-step penjumlahan cipher yang dilakukan
							}
							while (codepoints[i] < 2) { //Mencegah kode poin lebih kecil daripada 2
								codepoints[i] += 1114110; //1 + x = 1114111 (x = 1114110)
							}
							while (codepoints[i] > 1114111) { //Mencegah kode poin lebih besar daripada 1114111 (1114111 adalah kode terakhir)
								codepoints[i] -= 1114110; //1114112 - x = 2 (x = 1114110)
							}
							if (codepoints[i] === 13) { //Jika kode poin bernilai 13, yaitu carriage return yang akan berubah menjadi karakter dengan kode poin 10 di textarea,
								codepoints[i] = 1; //Maka ubah kode poin menjadi bernilai 1
							}
							arrayCipher[i] = String.fromCodePoint(codepoints[i]); //ubah kode poin ke karakter
							if (decrypting === false) { //Jika sedang mengenkripsi
								arrayCipher[i] += String.fromCodePoint(0); //Selipkan karakter dengan kode poin 0 untuk mencegah dua karakter surrogate pair menggabungkan diri dan membentuk karakter baru
							}
							vigenereIndex += 1; //Ganti ke kunci vigenere selanjutnya
							if (vigenereIndex === vigenereKey.length) { //Jika kunci vigenere terakhir sudah dipakai, balik ke kunci vigenere awal
								vigenereIndex = 0;
							}
						}
					}
					$("#teksHasil").val(arrayCipher.join("")); //Karakter hasil cipher digabungkan menjadi satu teks hasil cipher
					setCaesarKeyDebug();
					setVigenereKeyDebug();
					//$("#proses").html(proses.join("<br>")); //Menunjukkan step-step penjumlahan yang dilakukan
				}
			}
			function downloadFile(fileName, file) { //Fungsi unduh file
				const a = document.createElement("a");
				a.style = "display: none";
				a.href = URL.createObjectURL(file);
				a.download = fileName;
				document.body.appendChild(a);
				a.click();
				a.remove();
				setTimeout(() => URL.revokeObjectURL(a.href), 1000);
			}
			function saveText() { //Base64 to File
				const teksHasil = $("#teksHasil").val();
				const arr = teksHasil.split(',');
				const bstr = atob(arr[1]);
				let n = bstr.length;
				const u8arr = new Uint8Array(n);
				while (n--) {
					u8arr[n] = bstr.codePointAt(n);
				}
				const file = new File([u8arr], "test.bin", {
					type: arr[0].match(/:(.*?);/)[1]
				});
				const saveTextFileName = $("#saveTextFileName").val();
				if (saveTextFileName.length !== 0) {
					downloadFile(saveTextFileName, file);
				}
				else {
					downloadFile("fileName.bin", file);
				}
			}
			function saveTextCode() {
				const teksHasil = $("#teksHasil").val();
				const arrayKarakter = [...teksHasil];
				const codepoints = [];
				for (let i = 0; i < arrayKarakter.length; i++) {
					codepoints[i] = "u" + arrayKarakter[i].codePointAt(0).toString(16);
				}
				const file = new Blob([codepoints.join("")], {type: "octet/stream"});
				const saveTextFileCodeName = $("#saveTextFileCodeName").val();
				if (saveTextFileCodeName.length !== 0) {
					downloadFile(saveTextFileCodeName + ".ciphereki", file);
				}
				else {
					downloadFile("fileName.ciphereki", file);
				}
			}
		</script>
	</body>
</html>
<!-- Ini Komentar -->
