<!DOCTYPE html>
<html lang=id>
	<head>
		<title>Unicode cipher</title>
		<meta
			http-equiv=Content-Type
			content="text/html; charset=utf-8"/>
		<script
			src="https://code.jquery.com/jquery-3.6.0.min.js"></script></head>
	<body>
		<div style="background-color: lightgreen;">
			<p>Original Text:</p>
			<textarea id="teks-Asal"
				rows="30"
				cols="100"
				spellcheck="false" 
				autocapitalize="off"></textarea>
			<br>
			<input id="loadFile-asDataURL"
				onchange="loadFile.asDataURL(this); //JS"
				type="file"/>
				<label for="loadFile-asDataURL">File to data URL Base64</label>
			<br>
			<input id="loadFile-asEncryptedText"
				onchange="loadFile.asEncryptedText(this); //JS"
				type="file"
				accept=".ciphereki"/>
				<label for="loadFile-asEncryptedText">Ciphereki to String</label></div>
		<div style="background-color: lightblue;">
			<p>Caesar Key:</p>
			<input id="caesar-keyInput"
				oninput="$(this).val(this.value.replace(/[^0-9]/g, '')); caesar.setKey(); //JS"
				type="text"
				size="98"/>
			<br>
			<input id="caesar-direction_button"
				onclick="caesar.setDirection(); //JS"
				type="button"
				value="+"/>
			<p id="caesar-debug">Caesar key = 0</p></div>
		<div style="background-color: lightpink;">
			<p>Vigenere Key:</p>
			<textarea id="vigenere-keyInput"
				oninput="vigenere.setKey(); //JS"
				rows="10"
				cols="100"></textarea>
			<br>
			<input id="vigenere-direction_button"
				onclick="vigenere.setDirection(); //JS"
				type="button"
				value="+"/>
			<p id="vigenere-debug">Vigenere key = 0</p></div>
		<div style="background-color: mediumpurple;">
			<input id="cipherText"
				onclick="cipherText(); //JS"
				type="button"
				value="Jalankan cipher"/>
			<p>Cipher Text:</p>
			<textarea id="teks-Hasil"
				rows="30"
				cols="100"
				spellcheck="false"
				autocapitalize="off"
				readonly></textarea>
			<input id="moveUp"
				onclick="$('#teks-Asal').val(''); $('#teks-Asal').val($('#teks-Hasil').val()); //JS"
				type="button"
				value="â†‘"/>
			<br>
			<input id="saveText-fromDataURL_name"
				type="text"/>
			<input id="saveText-fromDataURL"
				onclick="saveText.fromDataURL(); //JS"
				type="button"
				value="Save File"/>
				<label for="saveText-fromDataURL">Data URL Base64 to File</label>
			<br>
			<input id="saveText-fromEncryptedText_name"
				type="text"/>
			<input id="saveText-fromEncryptedText"
				onclick="saveText.fromEncryptedText(); //JS"
				type="button" 
				value="Save File"/>
				<label for="saveText-fromEncryptedText">String to Ciphereki</label></div>
		<script>
			"use strict";
			const caesar = {
				key: 0,
				direction: 1, //Variabel penentu apakah caesar cipher digeser ke depan atau belakang (Kalau 1 geser ke depan, kalau -1 geser ke belakang)
				setKey() {
					let angka = $("#caesar-keyInput").val(); //Ambil kunci caesar
					if (angka.length !== 0) { //Jika kunci caesar tidak kosong, jalankan if
						angka = parseInt(angka) * this.direction; //Menentukan apakah caesar cipher digeser ke depan atau belakang
						this.key = angka;
					}
					else { //Jika kunci caesar kosong, maka kunci caesar adalah 0
						this.key = 0;
					}
					$("#caesar-debug").html("Caesar key = " + this.key); //Menunjukkan kunci cipher yang sedang digunakan
				},
				setDirection() { //Fungsi untuk menentukan apakah caesar cipher digeser ke depan atau belakang
					const button = $("#caesar-direction_button");
					if (button.val() === "+") {
						button.val("-");
					}
					else {
						button.val("+");
					}
					this.direction *= -1;
					this.setKey();
				},
			};
			const vigenere = {
				key: [0],
				direction: 1, //Variabel penentu apakah vigenere cipher digeser ke depan atau belakang (Kalau 1 geser ke depan, kalau -1 geser ke belakang)
				setKey() {
					const huruf = $("#vigenere-keyInput").val(); //Ambil kunci vigenere
					if (huruf.length !== 0) { //Jika kunci vigenere tidak kosong, jalankan if
						const arrayKunci = [...huruf]; //Ubah kunci vigenere ke bentuk array berisi huruf
						for (let i = 0; i < arrayKunci.length; i++) { //Jalankan sebanyak jumlah huruf pada arrayKunci
							arrayKunci[i] = arrayKunci[i].codePointAt(0) * this.direction; //Ubah isi arrayKunci dari huruf ke kode poin tiap-tiap huruf sekaligus menentukan apakah vigenere cipher digeser ke depan atau belakang
						}
						this.key = arrayKunci;
					}
					else { //Jika kunci vigenere kosong, maka kunci vigenere adalah 0
						this.key = [0];
					}
					$("#vigenere-debug").html("Vigenere key = " + this.key); //Menunjukkan semua kunci vigenere yang sedang digunakan
				},
				setDirection() { //Fungsi untuk mengubah apakah vigenere cipher digeser ke depan atau belakang
					const button = $("#vigenere-direction_button");
					if (button.val() === "+") {
						button.val("-");
					}
					else {
						button.val("+");
					}
					this.direction *= -1;
					this.setKey();
				},
			};
			const loadFile = {
				asDataURL(input) {
					const reader = new FileReader(); //Buka file
					reader.readAsDataURL(input.files[0]); //Baca sebagai data URL Base64
					reader.onload = function (event) { //Jika file sudah dimuat
						$("#teks-Asal").val(event.target.result); //Hasil pengubahan dimuat di teks-Asal
						$("#loadFile-asDataURL").val(""); //loadFile-asDataURL dikosongkan supaya dapat memuat file lainnya
					};
				},
				asEncryptedText(input) { //Buka file dengan format .ciphereki
					const reader = new FileReader(); //Buka file
					reader.readAsText(input.files[0]); //Baca sebagai teks
					reader.onload = function(event) { //Jika file sudah dimuat
						const encode = event.target.result.split("u"); //File yang sudah dimuat dipisah dengan melihat huruf u
						let encodeText = []; //Siapkan array kosong yang nantinya akan diisi teks hasil pengubahan kode poin ke karakter
						encode.shift(); //Buang array bagian pertama karena bernilai null
						for (let i = 0; i < encode.length; i++) {
							encode[i] = "0x" + encode[i]; //Kode poin ditambahkan 0x supaya bisa diubah ke karakter
							encodeText[i] = String.fromCodePoint(parseInt(encode[i], 16)); //Ubah kode poin ke karakter
						}
						$("#teks-Asal").val(encodeText.join("")); //Hasil pengubahan dimuat di teks-Asal
						$("#loadFile-asEncryptedText").val(""); //loadFile-asEncryptedText dikosongkan supaya dapat memuat file lainnya
					};
				},
			};
			const cipherText = function () {
				let vigenereIndex = 0; //Buat variabel untuk menentukan posisi kunci vigenere yang akan digunakan
				const arrayKarakter = [...$("#teks-Asal").val()]; //Ambil textarea teks-Asal dan ubah teks ke array berisi tiap-tiap huruf
				let decrypting = false; //Buat variabel untuk menentukan apakah teks dienkripsi atau didekripsi, default enkripsi
				const codepoints = []; //Buat array kosong yang nanti akan diisi kode poin
				if (arrayKarakter.length > 1 && arrayKarakter[1].codePointAt(0) === 0) { //Memeriksa apakah karakter kedua adalah karakter dengan kode poin 0 jika teks terdapat lebih dari 1 karakter, jika iya maka teks akan didekripsi
					decrypting = true;
				}
				for (let i = 0; i < arrayKarakter.length; i++) { //Jalankan sebanyak jumlah huruf pada arrayKarakter
					if (arrayKarakter[i].codePointAt(0) === 0) { //Karakter dengan kode poin 0 akan dihapus
						arrayKarakter[i] = "";
					}
					else {
						if (parseInt(arrayKarakter[i].codePointAt(0)) === 1) { //Jika karakter memiliki kode poin 1
							codepoints[i] = 13 + parseInt(caesar.key) + parseInt(vigenere.key[vigenereIndex]); //Ubah kode poin 1 menjadi 13, lalu jumlahkan dengan kunci caesar dan kunci vigenere
						}
						else {
							codepoints[i] = arrayKarakter[i].codePointAt(0) + parseInt(caesar.key) + parseInt(vigenere.key[vigenereIndex]); //Jumlahkan kode poin per huruf dengan kunci caesar dan kunci vigenere
						}
						while (codepoints[i] < 2) { //Mencegah kode poin lebih kecil daripada 2
							codepoints[i] += 1114110; //1 + x = 1114111 (x = 1114110)
						}
						while (codepoints[i] > 1114111) { //Mencegah kode poin lebih besar daripada 1114111 (1114111 adalah kode terakhir)
							codepoints[i] -= 1114110; //1114112 - x = 2 (x = 1114110)
						}
						if (codepoints[i] === 13) { //Jika kode poin bernilai 13, yaitu carriage return yang akan berubah menjadi karakter dengan kode poin 10 di textarea,
							codepoints[i] = 1; //Maka ubah kode poin menjadi bernilai 1
						}
						arrayKarakter[i] = String.fromCodePoint(codepoints[i]); //ubah kode poin ke karakter dan ganti karakter asal ke karakter cipher
						vigenereIndex += 1; //Ganti ke kunci vigenere selanjutnya
						if (vigenereIndex === vigenere.key.length) { //Jika kunci vigenere terakhir sudah dipakai, balik ke kunci vigenere awal
							vigenereIndex = 0;
						}
					}
				}
				if (decrypting === false) { //Jika sedang mengenkripsi
					$("#teks-Hasil").val(arrayKarakter.join(String.fromCodePoint(0))); //Selipkan karakter dengan kode poin 0 untuk mencegah dua karakter surrogate pair menggabungkan diri dan membentuk karakter baru
				}
				else {
					$("#teks-Hasil").val(arrayKarakter.join("")); //Karakter hasil cipher digabungkan menjadi satu teks hasil cipher
				}
			}
			const saveText = {
				downloadFile(fileName, file) { //Fungsi unduh file
					const a = document.createElement("a");
					a.style = "display: none";
					a.href = URL.createObjectURL(file);
					a.download = fileName;
					document.body.appendChild(a);
					a.click();
					a.remove();
				},
				fromDataURL() { //Data URL Base64 to File
					try { //Jika teks-Hasil berisi data URL Base64 valid, jalankan:
						let fileName = $("#saveText-fromDataURL_name").val(); //Ambil isi dari saveText-fromDataURL_name sebagai nama file yang akan disimpan
						if (fileName.length === 0) { //Jika tidak ada nama berkas, nama berkas adalah "fileName"
							fileName = "fileName";
						}
						const arr = $("#teks-Hasil").val().split(','); //Ambil isi dari teks-Hasil lalu buat array dipisahkan dengan koma
						const binary = atob(arr[1]); //Array ke-2 diubah dari ASCII ke binary
						let n = binary.length;
						const u8arr = new Uint8Array(n); //Buat array kosong uint8array
						while (n--) {
							u8arr[n] = binary.codePointAt(n); //Isi array uint8array dengan kode poin dari binary
						}
						const file = new File([u8arr], "", {type: arr[0].match(/:(.*?);/)[1]}); //Buat file baru dengan mime type dari array ke-1
						this.downloadFile(fileName, file); //Unduh berkas
					}
					catch (err) { //Jika data URL korup atau tidak ada data URL valid:
						alert("Error: Only accept valid data URL Base64 format!");
					}
				},
				fromEncryptedText() {
					let fileName = $("#saveText-fromEncryptedText_name").val(); //Ambil isi saveText-fromEncryptedText_name sebagai nama file yang akan disimpan
					if (fileName.length === 0) { //Jika tidak ada nama berkas, nama berkas adalah "fileName"
						fileName = "filename";
					}
					const arrayKarakter = [...$("#teks-Hasil").val()]; //Ambil isi dari teks-Hasil lalu ubah menjadi array
					const codepoints = [];
					for (let i = 0; i < arrayKarakter.length; i++) {
						codepoints[i] = "u" + arrayKarakter[i].codePointAt(0).toString(16);
					}
					const file = new Blob([codepoints.join("")], {type: "text/plain"}); //Buat Data URL dengan tipe teks
					this.downloadFile(fileName + ".ciphereki", file);
				},
			};</script></body></html>
<!-- Ini Komentar -->