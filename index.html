<!DOCTYPE html>
<html lang=id>
	<head>
		<title>Unicode cipher</title>
		<meta
			http-equiv=Content-Type
			content="text/html; charset=utf-8"/>
		<script
			src="https://code.jquery.com/jquery-3.6.0.min.js"></script></head>
	<body>
		<div style="background-color: lightgreen;">
			<p>Original Text:</p>
			<textarea id="teksAsal"
				rows="30"
				cols="100"
				spellcheck="false" 
				autocapitalize="off"></textarea>
			<br>
			<input id="loadFile"
				onchange="loadFile(this); //Javascript"
				type="file"/>
				<label for="loadFile">File to data URL Base64</label>
			<br>
			<input id="loadFileCode"
				onchange="loadFileCode(this); //Javascript"
				type="file"
				accept=".ciphereki"/>
				<label for="loadFileCode">Ciphereki to String</label></div>
		<div style="background-color: lightblue;">
			<p>Caesar Key:</p>
			<input id="caesarKeyInput"
				oninput="$(this).val(this.value.replace(/[^0-9]/g, '')); getCaesarKey(); //Javascript"
				type="text"
				size="98"/>
			<br>
			<input id="plusMinusCaesar"
				onclick="plusMinusCaesarFunction(); //Javascript"
				type="button"
				value="+"/>
			<p id="caesarKeyDebug">Caesar key = 0</p></div>
		<div style="background-color: lightpink;">
			<p>Vigenere Key:</p>
			<textarea id="vigenereKeyInput"
				oninput="getVigenereKey(); //Javascript"
				rows="10"
				cols="100"></textarea>
			<br>
			<input id="plusMinusVigenere"
				onclick="plusMinusVigenereFunction(); //Javascript"
				type="button"
				value="+"/>
			<p id="vigenereKeyDebug">Vigenere key = 0</p></div>
		<div style="background-color: mediumpurple;">
			<input id="cipherText"
				onclick="cipherText(); //Javascript"
				type="button"
				value="Jalankan cipher"/>
			<p>Cipher Text:</p>
			<textarea id="teksHasil"
				rows="30"
				cols="100"
				spellcheck="false"
				autocapitalize="off"
				readonly></textarea>
			<input id="moveUp"
				onclick="$('#teksAsal').val(''); $('#teksAsal').val($('#teksHasil').val()); //Javascript"
				type="button"
				value="â†‘"/>
			<br>
			<input id="saveTextFileName"
				type="text"/>
			<input id="saveText"
				onclick="saveText(); //Javascript"
				type="button"
				value="Save File"/>
				<label for="saveText">Data URL Base64 to File</label>
			<br>
			<input id="saveTextFileCodeName"
				type="text"/>
			<input id="saveTextCode"
				onclick="saveTextCode(); //Javascript"
				type="button" 
				value="Save File"/>
				<label for="saveTextFileCodeName"> String to Ciphereki</label></div>
		<p id="proses"></p>
		<script>
			"use strict";
			let caesarKey = 0;
			let vigenereKey = [0];
			let plusMinusCaesar = 1; //Buat variabel penentu apakah caesar cipher digeser ke depan atau belakang (Kalau 1 geser ke depan, kalau -1 geser ke belakang)
			let plusMinusVigenere = 1; //Buat variabel penentu apakah vigenere cipher digeser ke depan atau belakang
			function loadFile(input) {
				const reader = new FileReader(); //Buka file
				reader.readAsDataURL(input.files[0]); //Baca sebagai data URL Base64
				reader.onload = function (event) { //Jika file sudah dimuat
					$("#teksAsal").val(event.target.result); //Hasil pengubahan dimuat di teksAsal
					$("#loadFile").val(""); //loadFile dikosongkan supaya dapat memuat file lainnya
				};
			}
			function loadFileCode(input) { //Buka file dengan format .ciphereki
				const reader = new FileReader(); //Buka file
				reader.readAsText(input.files[0]); //Baca sebagai teks
				reader.onload = function(event) { //Jika file sudah dimuat
					const encode = event.target.result.split("u"); //File yang sudah dimuat dipisah dengan melihat huruf u
					let encodeText = []; //Siapkan array kosong yang nantinya akan diisi teks hasil pengubahan kode poin ke karakter
					encode.shift(); //Buang array bagian pertama karena bernilai null
					for (let i = 0; i < encode.length; i++) {
						encode[i] = "0x" + encode[i]; //Kode poin ditambahkan 0x supaya bisa diubah ke karakter
						encodeText[i] = String.fromCodePoint(parseInt(encode[i], 16)); //Ubah kode poin ke karakter
					}
					$("#teksAsal").val(encodeText.join("")); //Hasil pengubahan dimuat di teksAsal
					$("#loadFileCode").val(""); //loadFileCode dikosongkan supaya dapat memuat file lainnya
				};
			}
			function getCaesarKey() {
				let angka = $("#caesarKeyInput").val(); //Ambil kunci caesar
				if (angka.length !== 0) { //Jika kunci caesar tidak kosong, jalankan if
					angka = parseInt(angka) * plusMinusCaesar; //Menentukan apakah caesar cipher digeser ke depan atau belakang
					caesarKey = angka;
				}
				else {
					caesarKey = 0;
				}
				$("#caesarKeyDebug").html("Caesar key = " + caesarKey); //Menunjukkan kunci cipher yang digunakan
			}
			function plusMinusCaesarFunction() { //Fungsi untuk menentukan apakah caesar cipher digeser ke depan atau belakang
				const elem = $("#plusMinusCaesar");
				if (elem.val() === "+") {
					elem.val("-");
				}
				else {
					elem.val("+");
				}
				plusMinusCaesar *= -1;
				getCaesarKey();
			}
			function getVigenereKey() {
				const huruf = $("#vigenereKeyInput").val(); //Ambil kunci vigenere
				if (huruf.length !== 0) { //Jika kunci vigenere tidak kosong, jalankan if
					const arrayKunci = [...huruf]; //Ubah kunci vigenere ke bentuk array berisi huruf
					const codepointsVigenere = []; //Buat array kosong yang nanti akan diisi kode poin sejumlah huruf
					for (let i = 0; i < arrayKunci.length; i++) { //Jalankan sebanyak jumlah huruf pada arrayKunci
						codepointsVigenere[i] = parseInt(arrayKunci[i].codePointAt(0)) * plusMinusVigenere; //Ubah isi codepointsVigenere dari huruf ke kode poin tiap-tiap huruf sekaligus menentukan apakah vigenere cipher digeser ke depan atau belakang
					}
					vigenereKey = codepointsVigenere;
				}
				else { //Jika kunci vigenere kosong, maka kunci vigenere adalah 0
					
					vigenereKey = [0];
				}
				$("#vigenereKeyDebug").html("Vigenere key = " + vigenereKey); //Menunjukkan semua kunci vigenere yang digunakan
			}
			function plusMinusVigenereFunction() { //Fungsi untuk mengubah apakah vigenere cipher digeser ke depan atau belakang
				const elem = $("#plusMinusVigenere");
				if (elem.val() === "+") {
					elem.val("-");
				}
				else {
					elem.val("+");
				}
				plusMinusVigenere *= -1;
				getVigenereKey();
			}
			function cipherText() {
				if ($("#teksAsal").val().length > 0) { //Jika teks asal tidak kosong, jalankan fungsi
					const teksAsal = $("#teksAsal").val(); //Ambil textarea asal
					let vigenereIndex = 0; //Buat variabel untuk menentukan posisi kunci vigenere yang akan digunakan
					const arrayCipher = []; //Buat array kosong yang nanti akan diisi teks hasil cipher
					const arrayKarakter = [...teksAsal]; //Ubah teks ke array berisi tiap-tiap huruf
					let decrypting = false; //Buat variabel untuk menentukan apakah teks dienkripsi atau didekripsi, default enkripsi
					const codepoints = []; //Buat array kosong yang nanti akan diisi kode poin
					if (arrayKarakter.length > 1 && parseInt(arrayKarakter[1].codePointAt(0)) === 0) { //Memeriksa apakah karakter kedua adalah karakter dengan kode poin 0 jika teks terdapat lebih dari 1 karakter, jika iya maka teks akan didekripsi
						decrypting = true;
					}
					for (let i = 0; i < arrayKarakter.length; i++) { //Jalankan sebanyak jumlah huruf pada arrayKarakter
						if (decrypting === true && parseInt(arrayKarakter[i].codePointAt(0)) === 0) { //Jika teks didekripsi, maka karakter dengan kode poin 0 akan dihapus
							arrayCipher[i] = "";
						}
						else {
							if (parseInt(arrayKarakter[i].codePointAt(0)) === 1) { //Jika karakter memiliki kode poin 1
								codepoints[i] = 13 + parseInt(caesarKey) + parseInt(vigenereKey[vigenereIndex]); //Ubah kode poin 1 menjadi 13, lalu jumlahkan dengan kunci caesar dan kunci vigenere
							}
							else {
								codepoints[i] = parseInt(arrayKarakter[i].codePointAt(0)) + parseInt(caesarKey) + parseInt(vigenereKey[vigenereIndex]); //Jumlahkan kode poin per huruf dengan kunci caesar dan kunci vigenere
							}
							while (codepoints[i] < 2) { //Mencegah kode poin lebih kecil daripada 2
								codepoints[i] += 1114110; //1 + x = 1114111 (x = 1114110)
							}
							while (codepoints[i] > 1114111) { //Mencegah kode poin lebih besar daripada 1114111 (1114111 adalah kode terakhir)
								codepoints[i] -= 1114110; //1114112 - x = 2 (x = 1114110)
							}
							if (codepoints[i] === 13) { //Jika kode poin bernilai 13, yaitu carriage return yang akan berubah menjadi karakter dengan kode poin 10 di textarea,
								codepoints[i] = 1; //Maka ubah kode poin menjadi bernilai 1
							}
							arrayCipher[i] = String.fromCodePoint(codepoints[i]); //ubah kode poin ke karakter
							vigenereIndex += 1; //Ganti ke kunci vigenere selanjutnya
							if (vigenereIndex === vigenereKey.length) { //Jika kunci vigenere terakhir sudah dipakai, balik ke kunci vigenere awal
								vigenereIndex = 0;
							}
						}
					}
					if (decrypting === false) { //Jika sedang mengenkripsi
						$("#teksHasil").val(arrayCipher.join(String.fromCodePoint(0))); //Selipkan karakter dengan kode poin 0 untuk mencegah dua karakter surrogate pair menggabungkan diri dan membentuk karakter baru
					}
					else {
						$("#teksHasil").val(arrayCipher.join("")); //Karakter hasil cipher digabungkan menjadi satu teks hasil cipher
					}
				}
			}
			function downloadFile(fileName, file) { //Fungsi unduh file
				const a = document.createElement("a");
				a.style = "display: none";
				a.href = URL.createObjectURL(file);
				a.download = fileName;
				document.body.appendChild(a);
				a.click();
				a.remove();
			}
			function saveText() { //Data URL Base64 to File
				try { //Jika teksHasil berisi data URL Base64 valid, jalankan:
					const teksHasil = $("#teksHasil").val(); //Ambil isi dari teksHasil
					let saveTextFileName = $("#saveTextFileName").val(); //Ambil isi dari saveTextFileName sebagai nama file yang akan disimpan
					if (saveTextFileName.length === 0) { //Jika tidak ada nama berkas, nama berkas adalah "fileName"
						saveTextFileName = "fileName";
					}
					const arr = teksHasil.split(','); //Buat array dari teksHasil dipisahkan dengan koma
					const binary = atob(arr[1]); //Array ke-2 diubah dari ASCII ke binary
					let n = binary.length;
					const u8arr = new Uint8Array(n); //Buat array kosong uint8array
					while (n--) {
						u8arr[n] = binary.codePointAt(n); //Isi array uint8array dengan kode poin dari binary
					}
					const file = new File([u8arr], "", {type: arr[0].match(/:(.*?);/)[1]}); //Buat file baru dengan mime type dari array ke-1
					downloadFile(saveTextFileName, file); //Unduh berkas
				}
				catch (err) { //Jika data URL korup atau tidak ada data URL valid:
					alert("Error: Only accept valid data URL Base64 format!");
				}
			}
			function saveTextCode() {
				const teksHasil = $("#teksHasil").val(); //Ambil isi dari teksHasil
				let saveTextFileCodeName = $("#saveTextFileCodeName").val(); //Ambil isi saveTextFileCodeName sebagai nama file yang akan disimpan
				if (saveTextFileCodeName.length === 0) {
					saveTextFileCodeName = "filename";
				}
				const arrayKarakter = [...teksHasil]; //Ubah isi teksHasil menjadi array
				const codepoints = [];
				for (let i = 0; i < arrayKarakter.length; i++) {
					codepoints[i] = "u" + arrayKarakter[i].codePointAt(0).toString(16);
				}
				const file = new Blob([codepoints.join("")], {type: "text/plain"}); //Buat Data URL dengan tipe teks
				downloadFile(saveTextFileCodeName + ".ciphereki", file);
			}</script></body></html>
<!-- Ini Komentar -->